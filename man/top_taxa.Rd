% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/top_taxa.R
\name{top_taxa}
\alias{top_taxa}
\title{Analyze and visualize top abundant taxa at different taxonomic levels}
\usage{
top_taxa(
  data,
  sample,
  taxo,
  which = "phylum",
  n_top = 9,
  by = "sum",
  method = "wilcox",
  ref = "CK",
  p_threshold = 0.05,
  abundance_transform = "none",
  show_statistics = TRUE,
  color_palette = "d3",
  plot_type = "stacked_bar",
  verbose = TRUE
)
}
\arguments{
\item{data}{Feature abundance table (OTU/ASV table) where rows represent 
samples and columns represent features. Row names should be sample IDs 
matching those in the sample table.}

\item{sample}{Sample metadata table where the first column contains sample 
names and must include a 'group' column for statistical comparisons.}

\item{taxo}{Taxonomic classification table where rows represent features 
(matching column names in data) and columns represent taxonomic levels 
(e.g., phylum, class, order, family, genus, species).}

\item{which}{Character string specifying which taxonomic level to analyze. 
Must be a column name in the taxo table. Default is "phylum".}

\item{n_top}{Integer specifying the number of top taxa to display separately. 
Remaining taxa will be grouped as "Other". Default is 9 (showing top 9 + Other = 10 total).}

\item{by}{Character string specifying how to calculate abundance rankings. 
Options: "sum" (total abundance), "mean" (average abundance), "prevalence" 
(number of samples present). Default is "sum".}

\item{method}{Character string specifying the statistical test method. 
Options: "wilcox" (Wilcoxon rank-sum test), "t.test" (t-test), "kruskal" 
(Kruskal-Wallis test). Default is "wilcox".}

\item{ref}{Character string specifying the reference group for pairwise 
comparisons. Must be a level in the 'group' column. Default is "CK".}

\item{p_threshold}{Numeric value for p-value significance threshold. 
Default is 0.05.}

\item{abundance_transform}{Character string specifying abundance transformation. 
Options: "none", "log10", "sqrt", "arcsin_sqrt". Default is "none".}

\item{show_statistics}{Logical indicating whether to display significance 
symbols on the plot. Default is TRUE.}

\item{color_palette}{Character string specifying color palette. Options: 
"d3", "viridis", "brewer", "custom". Default is "d3".}

\item{plot_type}{Character string specifying plot type. Options: "stacked_bar", 
"grouped_bar", "heatmap". Default is "stacked_bar".}

\item{verbose}{Logical indicating whether to print progress information. 
Default is TRUE.}
}
\value{
A list containing five components:
\describe{
  \item{result.statistics}{A data frame containing statistical test results 
    for each taxon including p-values and significance levels.}
  \item{plot.abundance}{A ggplot object showing relative abundance 
    visualization with optional significance annotations.}
  \item{data.processed}{A data frame containing the processed abundance 
    data used for plotting and analysis.}
  \item{taxa.summary}{A summary table showing the top taxa selected and 
    their average abundances across groups.}
  \item{analysis.parameters}{A data frame recording all analysis parameters 
    for reproducibility.}
}
}
\description{
Identify the most abundant microorganisms at specified taxonomic levels and 
perform statistical comparisons between groups. This function creates both 
relative abundance visualizations and statistical analysis results for 
microbiome community composition studies.
}
\details{
The analysis workflow includes:
\enumerate{
  \item Merging abundance, sample, and taxonomic data
  \item Aggregating abundance by taxonomic level
  \item Selecting top N most abundant taxa
  \item Grouping remaining taxa as "Other"
  \item Performing statistical tests between groups
  \item Creating relative abundance visualization
}

Statistical tests available:
\itemize{
  \item Wilcoxon rank-sum test: Non-parametric, robust for microbiome data
  \item t-test: Parametric test for normally distributed data
  \item Kruskal-Wallis test: Non-parametric for multiple groups
}
}
\note{
\itemize{
  \item Sample names must match between data row names and sample table
  \item Feature names must match between data column names and taxo row names
  \item Missing taxonomic information will be labeled as "Unclassified"
  \item Very low abundance taxa may be filtered out automatically
}
}
\examples{
library(dplyr)
library(biohelpers)

# Load example microbiome data
data(df.top10.otu)
data(df.top10.sample) 
data(df.top10.class)

# Basic top taxa analysis at phylum level
top_result <- top_taxa(
  data = df.top10.otu,
  sample = df.top10.sample,
  taxo = df.top10.class,
  which = "phylum"
)

# View the plot
top_result$plot.abundance

# Check statistical results
top_result$result.statistics

# View taxa summary
top_result$taxa.summary

# Analysis at genus level with more taxa
genus_result <- top_taxa(
  data = df.top10.otu,
  sample = df.top10.sample,
  taxo = df.top10.class,
  which = "genus",
  n_top = 15,
  method = "kruskal"
)

# Custom visualization options
custom_result <- top_taxa(
  data = df.top10.otu,
  sample = df.top10.sample,
  taxo = df.top10.class,
  which = "family",
  abundance_transform = "log10",
  color_palette = "viridis",
  show_statistics = FALSE
)

# Access processed data for custom analysis
processed_data <- top_result$data.processed

# Create custom plot
library(ggplot2)
processed_data \%>\%
  ggplot(aes(x = sample, y = relative_abundance, fill = taxon)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~group, scales = "free_x") +
  theme_bio() +
  labs(title = "Custom Taxonomic Composition")

}
