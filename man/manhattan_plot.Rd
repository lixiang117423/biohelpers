% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/manhattan_plot.R
\name{manhattan_plot}
\alias{manhattan_plot}
\title{Create Manhattan Plot for Genome-Wide Association Study (GWAS) Results}
\usage{
manhattan_plot(
  df,
  p.threshold = NA,
  highlight.threshold = NULL,
  label.threshold = NULL,
  chr.colors = c("#1F77B4", "#FF7F0E"),
  point.size.range = c(0.5, 3),
  max.overlaps = 20,
  title = "Manhattan Plot",
  subtitle = "Genome-wide Association Study Results"
)
}
\arguments{
\item{df}{Data frame containing GWAS results with the following required columns:
\itemize{
  \item \code{chr}: Chromosome number (numeric or character)
  \item \code{posi} or \code{bp} or \code{pos}: Genomic position (base pairs)
  \item \code{p} or \code{pvalue} or \code{P}: P-value from association test
  \item \code{snp} or \code{SNP} or \code{rsid}: SNP identifier (optional, for labeling)
}
Additional optional columns:
\itemize{
  \item \code{label}: Custom labels for significant SNPs
  \item \code{gene}: Nearest gene name for annotation
}}

\item{p.threshold}{Significance threshold for drawing horizontal reference line
(default: Bonferroni correction = 0.05 / number of SNPs). Can be set to
custom values like 5e-8 (genome-wide significance) or 1e-5 (suggestive)}

\item{highlight.threshold}{P-value threshold for highlighting significant SNPs
(default: same as p.threshold). SNPs below this threshold will be emphasized}

\item{label.threshold}{P-value threshold for labeling SNPs (default: p.threshold).
Only SNPs more significant than this threshold will be labeled with text}

\item{chr.colors}{Vector of colors for alternating chromosomes (default: blue and orange).
Should have at least 2 colors that will be recycled across chromosomes}

\item{point.size.range}{Range of point sizes for SNPs (default: c(0.5, 3)).
Points are sized by -log10(p-value) within this range}

\item{max.overlaps}{Maximum number of overlapping labels allowed (default: 20).
Helps prevent overcrowded labels in regions of high significance}

\item{title}{Plot title (default: "Manhattan Plot"). Set to NULL to remove title}

\item{subtitle}{Plot subtitle (default: "Genome-wide Association Study Results")}
}
\value{
A ggplot2 object representing the Manhattan plot. Can be further
  customized with additional ggplot2 layers, themes, or saved using ggsave()
}
\description{
This function creates a publication-ready Manhattan plot for visualizing
genome-wide association study (GWAS) results. The plot displays -log10(p-values)
across chromosomes, with each chromosome represented by alternating colors.
Significant SNPs are highlighted and can be labeled. This visualization is
essential for identifying genomic regions associated with traits or diseases.
}
\details{
\strong{Manhattan Plot Components:}
\itemize{
  \item \strong{X-axis}: Genomic position across all chromosomes
  \item \strong{Y-axis}: -log10(p-value) from association tests
  \item \strong{Colors}: Alternating colors distinguish chromosomes
  \item \strong{Point size}: Proportional to -log10(p-value)
  \item \strong{Reference line}: Significance threshold (typically genome-wide significance)
  \item \strong{Labels}: Significant SNPs can be annotated with identifiers
}

\strong{Standard Significance Thresholds:}
\itemize{
  \item \strong{Genome-wide significance}: p < 5e-8 (-log10(p) > 7.3)
  \item \strong{Suggestive significance}: p < 1e-5 (-log10(p) > 5)
  \item \strong{Bonferroni correction}: p < 0.05/N where N = number of SNPs tested
}

\strong{Data Preparation Tips:}
\itemize{
  \item Ensure chromosome names are consistent (1-22, X, Y or chr1-chr22, chrX, chrY)
  \item Remove SNPs with p-value = 0 (set to minimum detectable p-value)
  \item Consider filtering SNPs with MAF < 0.01 or poor imputation quality
  \item Large datasets (>1M SNPs) may require thinning for visualization
}
}
\note{
\itemize{
  \item For large datasets, consider filtering or thinning SNPs for better performance
  \item The plot automatically scales Y-axis based on the most significant SNP
  \item Labels are placed using ggrepel to avoid overlapping
  \item Default colors follow scientific publication standards
}
}
\examples{
library(biohelpers)
library(dplyr)
library(ggplot2)

# Example 1: Basic Manhattan plot with simulated GWAS data
\dontrun{
# Generate simulated GWAS data
set.seed(20250312)

simulated_gwas <- normentR::simulateGWAS(nSNPs = 1e6, nSigCols = 3) \%>\%
  janitor::clean_names() \%>\%
  dplyr::rename(posi = bp) \%>\%
  dplyr::mutate(
    # Add labels for genome-wide significant SNPs
    label = case_when(
      p < 5e-8 ~ snp,  # Genome-wide significance
      TRUE ~ NA
    )
  )

# Create basic Manhattan plot
manhattan_basic <- manhattan_plot(simulated_gwas)
print(manhattan_basic)

# Summary of results
print(paste("Total SNPs:", nrow(simulated_gwas)))
print(paste("Genome-wide significant SNPs (p < 5e-8):", 
            sum(simulated_gwas$p < 5e-8, na.rm = TRUE)))
print(paste("Suggestive SNPs (p < 1e-5):", 
            sum(simulated_gwas$p < 1e-5, na.rm = TRUE)))
}

# Example 2: Custom significance thresholds
\dontrun{
# Manhattan plot with genome-wide significance threshold
manhattan_gwas <- manhattan_plot(
  df = simulated_gwas,
  p.threshold = 5e-8,           # Genome-wide significance
  highlight.threshold = 5e-8,    # Highlight genome-wide significant
  label.threshold = 1e-10,       # Label only very significant SNPs
  title = "GWAS: Height Association",
  subtitle = "Genome-wide significance threshold: p < 5×10⁻⁸"
)
print(manhattan_gwas)

# Add custom annotations
manhattan_annotated <- manhattan_gwas +
  annotate("text", x = Inf, y = Inf, 
           label = paste("N =", format(nrow(simulated_gwas), big.mark = ",")),
           hjust = 1.1, vjust = 1.5, size = 3) +
  labs(caption = "Data: Simulated GWAS results")

print(manhattan_annotated)
}

# Example 3: Multiple significance levels
\dontrun{
# Create plot with both genome-wide and suggestive thresholds
manhattan_multi <- manhattan_plot(
  df = simulated_gwas,
  p.threshold = 5e-8,
  chr.colors = c("#E31A1C", "#1F78B4"),  # Red and blue
  point.size.range = c(0.3, 2.5)
) +
  # Add suggestive significance line
  geom_hline(yintercept = -log10(1e-5), 
             color = "grey60", linetype = "dotted", alpha = 0.8) +
  # Add annotations for thresholds
  annotate("text", x = 0, y = -log10(5e-8) + 0.5, 
           label = "Genome-wide significance", 
           hjust = 0, size = 3, color = "grey40") +
  annotate("text", x = 0, y = -log10(1e-5) + 0.5, 
           label = "Suggestive significance", 
           hjust = 0, size = 3, color = "grey60")

print(manhattan_multi)
}

# Example 4: Real-world data format example
# This shows how to prepare your own GWAS data
sample_gwas_data <- data.frame(
  chr = rep(1:22, each = 1000),
  posi = rep(seq(1e6, 100e6, length.out = 1000), 22),
  snp = paste0("rs", 1:22000),
  p = runif(22000, min = 1e-12, max = 0.5),
  stringsAsFactors = FALSE
)

# Add some significant hits
sample_gwas_data$p[c(1000, 5000, 15000)] <- c(1e-9, 3e-8, 2e-11)
sample_gwas_data$label <- ifelse(sample_gwas_data$p < 5e-8, 
                                 sample_gwas_data$snp, NA)

\dontrun{
# Create Manhattan plot
real_world_plot <- manhattan_plot(
  df = sample_gwas_data,
  p.threshold = 5e-8,
  title = "Real-world GWAS Example",
  subtitle = "22 chromosomes, 22,000 SNPs"
)
print(real_world_plot)
}

# Example 5: Customization and export
\dontrun{
# Highly customized Manhattan plot
custom_manhattan <- manhattan_plot(
  df = simulated_gwas,
  p.threshold = 5e-8,
  chr.colors = c("#2E8B57", "#CD853F", "#4682B4", "#D2691E"),  # 4 colors
  point.size.range = c(0.2, 4),
  max.overlaps = 50,
  title = NULL  # Remove title for publication
) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_line(color = "grey90", size = 0.5),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.x = element_blank(),
    axis.title.y = element_text(size = 14),
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 10),
    plot.margin = margin(20, 20, 20, 20)
  ) +
  labs(y = expression(-log[10](italic(P))))

print(custom_manhattan)

# Save high-resolution plot
ggsave("manhattan_plot.png", custom_manhattan, 
       width = 12, height = 6, dpi = 300, bg = "white")

# Save as PDF for publications
ggsave("manhattan_plot.pdf", custom_manhattan, 
       width = 12, height = 6, device = "pdf")
}

# Example 6: Quality control and diagnostics
\dontrun{
# Check data quality before plotting
qc_summary <- simulated_gwas \%>\%
  summarise(
    total_snps = n(),
    chromosomes = n_distinct(chr),
    min_p = min(p, na.rm = TRUE),
    max_p = max(p, na.rm = TRUE),
    zero_p_values = sum(p == 0, na.rm = TRUE),
    na_p_values = sum(is.na(p)),
    genome_wide_sig = sum(p < 5e-8, na.rm = TRUE),
    suggestive_sig = sum(p < 1e-5, na.rm = TRUE)
  )

print("GWAS Data Quality Summary:")
print(qc_summary)

# Check genomic inflation
observed_chi2 <- qchisq(1 - simulated_gwas$p, df = 1)
lambda_gc <- median(observed_chi2, na.rm = TRUE) / qchisq(0.5, df = 1)
print(paste("Genomic inflation factor (λ):", round(lambda_gc, 3)))

if (lambda_gc > 1.1) {
  warning("Genomic inflation detected (λ > 1.1). Consider population stratification correction.")
}
}

}
\references{
Gibson, G. (2010). Hints of hidden heritability in GWAS. Nature Genetics, 42(7), 558-560.

Visscher, P. M., et al. (2017). 10 Years of GWAS Discovery: Biology, Function, and Translation. 
American Journal of Human Genetics, 101(1), 5-22.
}
\seealso{
\itemize{
  \item \code{\link{find_degs_deseq2}} for gene-level association analysis
  \item \code{\link[ggplot2]{ggplot}} for plot customization
  \item \code{\link[ggrepel]{geom_label_repel}} for label positioning
}
}
