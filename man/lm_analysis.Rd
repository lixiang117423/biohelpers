% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/lm_analysis.R
\name{lm_analysis}
\alias{lm_analysis}
\title{Perform Group-wise Linear Regression Analysis with Visualization}
\usage{
lm_analysis(
  data,
  x,
  y,
  group,
  color,
  alpha = 0.05,
  conf.level = 0.95,
  method = "lm",
  se = TRUE
)
}
\arguments{
\item{data}{Data frame containing all variables needed for the analysis.
Must include the variables specified in x, y, group, and color parameters}

\item{x}{Character string specifying the column name for the independent
variable (predictor). This variable will be plotted on the X-axis and
used as the predictor in linear regression models}

\item{y}{Character string specifying the column name for the dependent
variable (response). This variable will be plotted on the Y-axis and
used as the response in linear regression models}

\item{group}{Character string specifying the column name for the grouping
variable. Separate linear regression models will be fitted for each
unique level of this variable}

\item{color}{Character string specifying the column name for point colors
in the scatter plot. Often the same as the group variable but can be
different to show additional data dimensions}

\item{alpha}{Significance level for regression p-values (default: 0.05).
Used to determine statistical significance in the results summary}

\item{conf.level}{Confidence level for regression confidence intervals
(default: 0.95). Used in both statistical calculations and plot confidence bands}

\item{method}{Regression method for line fitting (default: "lm" for linear model).
Can also be "glm", "gam", "loess", or other methods supported by ggplot2::geom_smooth}

\item{se}{Logical indicating whether to display confidence intervals around
regression lines in the plot (default: TRUE)}
}
\value{
A named list containing two elements:
  \describe{
    \item{\code{regression_results}}{Data frame with group-wise regression statistics:
      \itemize{
        \item \code{group}: Group levels from the grouping variable
        \item \code{n_observations}: Number of observations in each group
        \item \code{r_squared}: Coefficient of determination (R²)
        \item \code{adj_r_squared}: Adjusted R-squared
        \item \code{slope}: Regression slope (effect of x on y)
        \item \code{intercept}: Y-intercept of regression line
        \item \code{slope_se}: Standard error of slope estimate
        \item \code{slope_pvalue}: P-value for slope significance test
        \item \code{overall_pvalue}: Overall model F-test p-value
        \item \code{significance}: Significance classification based on alpha
        \item \code{slope_ci_lower}: Lower bound of slope confidence interval
        \item \code{slope_ci_upper}: Upper bound of slope confidence interval
      }}
    \item{\code{scatter_plot}}{ggplot2 object showing scatter plot with:
      \itemize{
        \item Individual data points colored by group
        \item Fitted regression lines for each group
        \item Confidence intervals (optional)
        \item Professional theme and labeling
      }}
  }
}
\description{
This function performs linear regression analysis between two continuous variables
within each level of a grouping variable. It calculates regression statistics
(R-squared, p-values, coefficients) for each group separately and creates an
integrated scatter plot with fitted regression lines. This is particularly
useful for comparing relationships across different experimental conditions,
species, treatments, or other categorical groupings.
}
\details{
For each group, the function fits a linear regression model: y ~ x and extracts:
\itemize{
  \item \strong{R-squared}: Proportion of variance in y explained by x
  \item \strong{Adjusted R-squared}: R² adjusted for degrees of freedom
  \item \strong{Slope}: Rate of change in y per unit change in x
  \item \strong{P-values}: Statistical significance of slope and overall model
  \item \strong{Confidence intervals}: Uncertainty bounds for slope estimates
}

The visualization combines all groups in a single plot for easy comparison
of regression relationships across groups.
}
\note{
\itemize{
  \item Both x and y variables should be continuous (numeric)
  \item Each group should have at least 3 observations for reliable regression
  \item The function assumes linear relationships; check residual plots for model validity
  \item Groups with insufficient data will generate warnings
  \item Consider data transformation if relationships appear non-linear
}
}
\examples{
library(biohelpers)
library(dplyr)
library(ggplot2)

# Example 1: Basic regression analysis with iris data
data(iris)

# Analyze relationship between sepal length and width by species
results <- lm_analysis(
  data = iris,
  x = "Sepal.Length",
  y = "Sepal.Width", 
  group = "Species",
  color = "Species"
)

# View regression statistics
print("Regression results by species:")
print(results$regression_results)

# Display the plot
print(results$scatter_plot)

# Summary of significant relationships
significant_groups <- results$regression_results \%>\%
  filter(significance == "Significant")

print(paste("Significant relationships found in", nrow(significant_groups), "groups"))

# Example 2: Custom analysis parameters
results_custom <- lm_analysis(
  data = iris,
  x = "Petal.Length",
  y = "Petal.Width",
  group = "Species", 
  color = "Species",
  alpha = 0.01,        # More stringent significance level
  conf.level = 0.99,   # Wider confidence intervals
  se = TRUE            # Show confidence bands
)

print("Custom analysis results:")
print(results_custom$regression_results[, c("group", "slope", "r_squared", "significance")])

# Example 3: Biological application with simulated data
# Simulate dose-response relationship across treatments
set.seed(123)

dose_response_data <- data.frame(
  dose = rep(c(0, 1, 2, 5, 10, 20), each = 15),
  treatment = rep(c("Drug_A", "Drug_B", "Placebo"), each = 30),
  response = c(
    # Drug A: strong dose-response
    0 + rnorm(15, 0, 1),
    5 + rnorm(15, 0, 1.2),
    10 + rnorm(15, 0, 1.5),
    20 + rnorm(15, 0, 2),
    35 + rnorm(15, 0, 2.5),
    50 + rnorm(15, 0, 3),
    # Drug B: moderate dose-response  
    0 + rnorm(15, 0, 1),
    2 + rnorm(15, 0, 1.1),
    4 + rnorm(15, 0, 1.3),
    8 + rnorm(15, 0, 1.8),
    15 + rnorm(15, 0, 2.2),
    22 + rnorm(15, 0, 2.8),
    # Placebo: minimal response
    0 + rnorm(15, 0, 1),
    0.5 + rnorm(15, 0, 1.1),
    1 + rnorm(15, 0, 1.2),
    1.2 + rnorm(15, 0, 1.3),
    1.5 + rnorm(15, 0, 1.4),
    2 + rnorm(15, 0, 1.5)
  )
)

# Analyze dose-response relationships
dose_analysis <- lm_analysis(
  data = dose_response_data,
  x = "dose", 
  y = "response",
  group = "treatment",
  color = "treatment"
)

print("Dose-response analysis:")
print(dose_analysis$regression_results[, c("group", "slope", "r_squared", "overall_pvalue")])

# Enhanced plot with custom styling
enhanced_plot <- dose_analysis$scatter_plot +
  labs(
    title = "Dose-Response Relationships by Treatment",
    subtitle = "Linear regression analysis of treatment efficacy",
    x = "Dose (mg/kg)",
    y = "Response (arbitrary units)",
    color = "Treatment Group"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12),
    legend.position = "bottom"
  )

print(enhanced_plot)

# Example 4: Quality control and diagnostics
# Check assumptions for each group
regression_diagnostics <- dose_response_data \%>\%
  group_by(treatment) \%>\%
  do({
    model <- lm(response ~ dose, data = .)
    data.frame(
      treatment = unique(.$treatment),
      normality_test = shapiro.test(residuals(model))$p.value,
      residual_mean = mean(residuals(model)),
      residual_sd = sd(residuals(model))
    )
  }) \%>\%
  ungroup()

print("Regression diagnostics:")
print(regression_diagnostics)

# Example 5: Comparative analysis
# Compare slope estimates between groups
slope_comparison <- dose_analysis$regression_results \%>\%
  select(group, slope, slope_se, slope_ci_lower, slope_ci_upper) \%>\%
  arrange(desc(slope))

print("Slope comparison (effect size ranking):")
print(slope_comparison)

# Statistical comparison of slopes (approximate)
# Note: For formal slope comparison, use interaction terms in a single model
slopes_overlap <- function(row1, row2) {
  ci1 <- c(row1$slope_ci_lower, row1$slope_ci_upper)
  ci2 <- c(row2$slope_ci_lower, row2$slope_ci_upper)
  overlap <- max(ci1[1], ci2[1]) <= min(ci1[2], ci2[2])
  return(overlap)
}

print("Confidence interval overlaps (approximate slope comparison):")
for (i in 1:(nrow(slope_comparison)-1)) {
  for (j in (i+1):nrow(slope_comparison)) {
    overlap <- slopes_overlap(slope_comparison[i,], slope_comparison[j,])
    print(paste(slope_comparison$group[i], "vs", slope_comparison$group[j], ":", 
                ifelse(overlap, "Overlapping CIs", "Non-overlapping CIs")))
  }
}

}
\seealso{
\itemize{
  \item \code{\link[stats]{lm}} for underlying linear regression implementation
  \item \code{\link{cor_analysis}} for correlation analysis
  \item \code{\link{anova_posthoc}} for group comparisons
}
}
