% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_admixture.R
\name{admixture_phylo_analysis}
\alias{admixture_phylo_analysis}
\title{Analyze Admixture results with phylogenetic ordering and visualization}
\usage{
admixture_phylo_analysis(
  admixture_path,
  tree_file,
  output_dir = NULL,
  population_info = NULL,
  k_range = NULL,
  plot_width = 15,
  plot_height = 1,
  tree_width = 3,
  tree_height = 15,
  dpi = 500,
  color_palette = NULL,
  show_tree_branch_length = FALSE,
  output_prefix = "admixture_phylo_analysis",
  align_clusters = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{admixture_path}{Character string specifying the directory path containing 
Admixture .Q files. All .Q files in this directory will be processed.}

\item{tree_file}{Character string specifying the path to the phylogenetic tree 
file (Newick format). Sample names in the tree must match those in the 
Admixture files.}

\item{output_dir}{Character string specifying the output directory for plots. 
Default is the same as admixture_path.}

\item{population_info}{Optional data frame containing population information 
with columns 'sample' and 'population'. If provided, samples will be 
grouped by population before phylogenetic ordering. Default is NULL.}

\item{k_range}{Integer vector specifying which K values to include in the 
analysis. Can be specified as a range (e.g., 2:5) or specific values 
(e.g., c(2,3,5)). If NULL, all available K values will be used. Default is NULL.}

\item{plot_width}{Numeric value specifying the width of the admixture plot 
in inches. Default is 15.}

\item{plot_height}{Numeric value specifying the height of the admixture plot 
in inches. Default is 1.}

\item{tree_width}{Numeric value specifying the width of the phylogenetic tree 
plot in inches. Default is 3.}

\item{tree_height}{Numeric value specifying the height of the phylogenetic 
tree plot in inches. Default is 15.}

\item{dpi}{Numeric value specifying the resolution for output plots. 
Default is 500.}

\item{color_palette}{Character vector of colors for different ancestry 
components. If NULL, uses a default color scheme. Colors will be 
dynamically adjusted based on the maximum K value in the analysis.}

\item{show_tree_branch_length}{Logical indicating whether to show branch 
lengths in the phylogenetic tree. Default is FALSE.}

\item{output_prefix}{Character string for output file naming prefix. 
Default is "admixture_phylo_analysis".}

\item{align_clusters}{Logical indicating whether to align clusters across 
different K values. Default is TRUE.}

\item{verbose}{Logical indicating whether to print progress information. 
Default is TRUE.}
}
\value{
A list containing six components:
\describe{
  \item{qlist.original}{Original Q matrices read from files.}
  \item{qlist.ordered}{Q matrices reordered according to phylogenetic topology.}
  \item{tree.plot}{ggplot object of the phylogenetic tree.}
  \item{sample.order}{Data frame showing the final sample ordering with 
    phylogenetic and population information.}
  \item{summary.statistics}{Summary statistics from pophelper analysis.}
  \item{output.files}{Character vector of created output file paths.}
}
}
\description{
Process Admixture .Q files and create population structure plots ordered 
according to phylogenetic tree topology. This function integrates phylogenetic 
relationships with population genetic structure analysis for comprehensive 
evolutionary insights.
}
\details{
The function workflow includes:
\enumerate{
  \item Reading all .Q files from the specified directory
  \item Processing and summarizing admixture results
  \item Aligning clusters across different K values (optional)
  \item Reading phylogenetic tree and extracting tip order
  \item Reordering samples based on phylogenetic relationships
  \item Incorporating population structure if provided
  \item Creating publication-ready plots with matching dimensions
}

The phylogenetic ordering ensures that:
\itemize{
  \item Closely related samples appear adjacent in plots
  \item Population structure patterns can be interpreted in evolutionary context
  \item Tree and admixture plots have matching sample orders for easy comparison
}
}
\note{
\itemize{
  \item Sample names must be consistent across .Q files and phylogenetic tree
  \item Requires pophelper, ape, ggtree, and dplyr packages
  \item Output plots are designed for easy horizontal concatenation
  \item Tree plot height should match admixture plot height for alignment
}
}
\examples{
\dontrun{
# Basic analysis with specific K range
result <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/",
  tree_file = "path/to/phylogenetic_tree.nwk",
  output_dir = "path/to/output/",
  k_range = 2:5  # Only analyze K=2,3,4,5
)

# View the plots
result$tree.plot

# Access reordered data
head(result$sample.order)

# With population information and specific K values
pop_info <- data.frame(
  sample = c("sample1", "sample2", "sample3"),
  population = c("Pop1", "Pop1", "Pop2")
)

result_with_pop <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/",
  tree_file = "path/to/phylogenetic_tree.nwk",
  population_info = pop_info,
  k_range = c(2, 3, 5),  # Only K=2,3,5
  output_dir = "path/to/output/",
  plot_width = 20,
  tree_width = 4
)

# Custom colors with automatic adjustment
custom_colors <- c("#FF6B6B", "#4ECDC4", "#45B7D1", "#96CEB4", 
                   "#FFEAA7", "#DDA0DD", "#98D8C8", "#F7DC6F")

result_custom <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/",
  tree_file = "path/to/phylogenetic_tree.nwk",
  k_range = 2:6,
  color_palette = custom_colors,  # Will extend if needed
  show_tree_branch_length = TRUE,
  dpi = 300
)
}

}
